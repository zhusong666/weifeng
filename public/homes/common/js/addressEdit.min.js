!function(e){function r(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return e[t].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var i={};return r.m=e,r.c=i,r.p="",r(0)}([function(e,r,i){e.exports=i(1)},function(e,r,i){i(2),MI.addressEdit=function(){function e(e,r,i){var t=!1,n={regions:[]};if(addressConfig.addressMatchData&&"function"==typeof addressConfig.addressMatchData&&(t=addressConfig.addressMatchData()),t){var d=t.length;e=parseInt(e),i=parseInt(i);for(var o=0;d>o;o+=1)if(1===e)n.regions.push({region_id:t[o].id,region_name:t[o].name,zipcode:0});else for(var s=0;s<t[o].child.length;s+=1)if(t[o].id===e)n.regions.push({region_id:t[o].child[s].id,region_name:t[o].child[s].name,zipcode:0});else for(var l=0;l<t[o].child[s].child.length;l+=1)if(t[o].child[s].id===e)n.regions.push({region_id:t[o].child[s].child[l].id,region_name:t[o].child[s].child[l].name,zipcode:t[o].child[s].child[l].zipcode?t[o].child[s].child[l].zipcode:""});else if(c)for(var g=0;g<t[o].child[s].child[l].tags.length;g+=1)t[o].child[s].child[l].id===e&&n.regions.push({region_id:t[o].child[s].child[l].tags[g].id,region_name:t[o].child[s].child[l].tags[g].name,zipcode:0});MI.getRegions.formatData(n,r,i),"edit"===a&&i&&$("#"+r).trigger("change")}}function r(e){if(e.length){var r,i=e.attr("name"),t=$.trim(e.val());if("user_name"===i){if(r=/^[a-zA-Z\u4e00-\u9fa5·]+$/,t.length<2||t.length>20)return e.trigger("error",["收货人姓名，最少2个最多20个中文字"]),!1;if(!r.test(t))return e.trigger("error",["收货人姓名不正确（只能是英文、汉字）"]),!1;e.trigger("valid"),n.uname=t}else if("user_phone"===i){if(r=/^1[0-9]{10}$/,!r.test(t)&&"edit"!==a)return e.trigger("error",["请输入正确的手机号"]),!1;if("edit"===a&&""!==t&&!r.test(t))return e.trigger("error",["请输入正确的手机号"]),!1;e.trigger("valid"),n.phone=t}else if("user_adress"===i){t=t.replace(/</g,"").replace(/>/g,"").replace(/\//g,"").replace(/\\/g,""),r=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var d=/^\d+$/,o=/^[0-9a-zA-Z]+$/;if(t.length<5||t.length>32)return e.trigger("error",["详细地址长度不对，最小为 5 个字，最大32个字"]),!1;if(r.test(t)||d.test(t)||o.test(t))return e.trigger("error",["详细地址不正确"]),!1;n.address=t}else if("user_zipcode"===i){if(r=/^\d{6}$/,!r.test(t))return e.trigger("error",["邮编是6位数字"]),!1;n.zipcode=t}else if("user_tag"===i){if(t.length>5)return e.trigger("error",["地址标签最长5个字"]),!1;n.tag=t}return!0}}function i(){$("#user_phone").attr("placeholder",addressConfig.fromAddress.tel),$("#user_adress").val(addressConfig.fromAddress.address).trigger("focus"),addressConfig.fromAddress.tag_name&&$("#user_tag").val(addressConfig.fromAddress.tag_name).trigger("focus"),$("#user_name").val(addressConfig.fromAddress.consignee).trigger("focus")}function t(){var e={consignee:n.uname,province_id:n.province,city_id:n.city,district_id:n.county,area:n.area,address:n.address,zipcode:n.zipcode,tel:n.phone,tag_name:n.tag,address_match:o};"edit"===a&&(e.address_id=addressConfig.addressId);var r=window.location.href;$.ajax({type:"POST",url:r,dataType:"json",data:{newAddress:e,risk_token:l},timeout:1e4,error:function(){},success:function(e){d&&e&&window.parent.editAddressCallback.save(e,a,n)}})}var n={},a="",d=null,o="",s=["tv","blance","tv70"],c=!1,l="",g=function(){MI.form.init(),a=u.getQueryString("action"),o=addressConfig.addressMatch,c=$.inArray(o,s)>=0?!0:!1,window.parent&&window.parent.editAddressCallback&&(d=window.parent.editAddressCallback),"edit"!==a&&e(1,"J_province"),$("#J_province").on("change",function(){var r=$(this).val();$("#J_county, #J_area").val("0").prop("disabled",!0),"0"!==r?(n.province=r,n.provinceName=$(this).find("option:selected").html(),"edit"===a?e(r,"J_city",addressConfig.fromAddress.city_id):e(r,"J_city")):(n.province=null,n.provinceName=null)}),$("#J_city").on("change",function(){var r=$(this).val();$("#J_area").val("0").prop("disabled",!0),"0"!==r?(n.city=r,n.cityName=$(this).find("option:selected").html(),"edit"===a?e(r,"J_county",addressConfig.fromAddress.district_id):e(r,"J_county")):(n.city=null,n.cityName=null)}),$("#J_county").on("change",function(){var r=$(this).val();"0"!==r?(n.county=r,n.countyName=$(this).find("option:selected").html(),n.zipcode=$(this).find("option:selected").attr("zipcode"),c&&"edit"===a?e(r,"J_area",addressConfig.fromAddress.area):c&&e(r,"J_area"),n.zipcode&&$("#user_zipcode").trigger("focus").val(n.zipcode)):(n.county=null,n.countyName=null,n.zipcode=null)}),c?($("#J_area").parents(".xm-select").removeClass("hide").parent().addClass("form-select-2"),$("#J_area").on("change",function(){var e=$(this).val();n.area="0"!==e?e:null})):n.area=0,d&&"edit"===a&&(addressConfig.fromAddress=d.getAddress(),e(1,"J_province",addressConfig.fromAddress.province_id),i()),$("#J_save").on("click",function(){var e=!1;if($(".J_addressInput").each(function(){return e=r($(this)),e?void 0:!1}),e&&n.province&&n.city&&n.county){if(c&&!n.area)return!1;t(),"edit"!==a||n.phone||(n.phone=addressConfig.fromAddress.tel)}}),$("#J_cancel").on("click",function(){d&&d.cancel()});var g=u.getQueryString("hastv");"true"===g&&$("#user_name").attr("placeholder","收货时将核对身份证信息").siblings("label").html("真实姓名"),l=window.parent.getUserTiskToken()},u={getQueryString:function(e){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(r);return null!==i?decodeURIComponent(i[2]):null}};return{init:g}}(),$(document).ready(function(){MI.addressEdit.init()})},function(e,r){MI.getRegions={getUrl:"/region/index",getData:function(e,r,i){var t=this;$.ajax({type:"GET",url:t.getUrl,data:"parent="+e,dataType:"json",success:function(e){e&&t.formatData(e,r,i)}})},formatData:function(e,r,i){for(var t=e.regions,n=t.length,a=$("#"+r),d='<option value="0">'+a.children("option").eq(0).html()+"</option>",o=0;n>o;o+=1){var s=t[o].region_id===i?"selected":"";d+='<option zipcode="'+t[o].zipcode+'" value="'+t[o].region_id+'"'+s+">"+t[o].region_name+"</option>"}$("#"+r).html(d).prop("disabled",!1)}}}]);