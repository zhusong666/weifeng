ec.pkg("ec.product");ec.load("ajax");ec.load("ec.box",{loadType:"lazy"});ec.load("ec.form",{loadType:"lazy"});ec.product.cid="";ec.product.sortField="";ec.product.sortType="";ec.product.prdAttrList=[];ec.product.email=ec.util.escapeHtml(ec.account.email);ec.product.mobile=ec.util.escapeHtml(ec.account.mobile);ec.product.chooseCategory=function(a){ec.product.cid=a;ec.product.post()};ec.product.chooseAttrAllValue=function(a){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",a);ec.product.tmpOptAttrValue(a);ec.product.post()};ec.product.chooseAttrValue=function(c,b,d){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",c);ec.product.tmpOptAttrValue(c);var a={};a.attributeId=c;a.value=d;a.orderNum=b;ec.product.prdAttrList.push(a);ec.product.post()};ec.product.tmpOptAttrValue=function(a){if(a=="102435"||a=="102434"||a=="102436"){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102434");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102435");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102436")}};ec.product.sort=function(a){cur_sortField=ec.product.sortField||"3",cur_sortType=ec.product.sortType||"0",new_sortType="";switch(a){case"0":new_sortType="0";break;case"2":new_sortType="0";break;default:if(a==cur_sortField){new_sortType=cur_sortType=="0"?"1":"0"}else{if(a=="1"){new_sortType="1"}else{new_sortType="0"}}break}ec.product.sortType=new_sortType;ec.product.sortField=a;ec.product.post()};ec.product.more=function(c){var b=$(c).attr("class");if(b=="more more-expand"){$(c).attr("class","more more-drop");var a=$(c).parent(".p-operate").next(".p-expand").find("ul").first().outerHeight();$(c).parent(".p-operate").next(".p-expand").height(a)}else{$(c).attr("class","more more-expand");$(c).parent(".p-operate").next(".p-expand").removeAttr("style")}};ec.product.renderPage=function(e,d,a,c,b){ec.product.cid=e;ec.product.sortField=a;ec.product.sortType=c;ec.product.renderCategory();ec.product.renderAttribute(d);ec.product.renderSort(a,c);if(!b.totalPage||b.totalPage==1){return}if(b.pageNumber){$("#page_"+b.pageNumber+" li").attr("class","page-number link pgCurrent")}if(b.pageNumber==1){$("#page_ul li").eq(0).attr("class","pgNext link first first-empty");$("#page_ul li").eq(1).attr("class","pgNext link pre pre-empty")}if(b.pageNumber==b.totalPage){$("#page_ul .next").addClass("next-empty");$("#page_ul .last").addClass("last-empty")}if(b.pageNumber>1){$("#page_ul .first").click(function(){location.href="list-"+ec.product.cid+"-1-"+ec.product.sortField+"-"+ec.product.sortType});$("#page_ul .pre").click(function(){location.href="list-"+ec.product.cid+"-"+(b.pageNumber-1)+"-"+ec.product.sortField+"-"+ec.product.sortType})}if(b.pageNumber<b.totalPage){$("#page_ul .next").click(function(){location.href="list-"+ec.product.cid+"-"+(b.pageNumber+1)+"-"+ec.product.sortField+"-"+ec.product.sortType});$("#page_ul .last").click(function(){location.href="list-"+ec.product.cid+"-"+(b.totalPage)+"-"+ec.product.sortField+"-"+ec.product.sortType})}};ec.product.renderCategory=function(){$(".p-expand ul").each(function(){var b=$(this).children("li").first().outerHeight();var a=$(this).outerHeight();if(a>b){$(this).parent(".p-expand").prev(".p-operate").show()}})};ec.product.renderAttribute=function(d){for(var a=0;a<d.length;a++){var c=d[a];var b=c.attributeId;if(b=="102435"||b=="102434"||b=="102436"){$("#pro-cate-attr-102435").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102434").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102436").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102435 li a[order-num="+c.orderNum+"]").parent("li").addClass("selected");$("#pro-cate-attr-102434 li a[order-num="+c.orderNum+"]").parent("li").addClass("selected");$("#pro-cate-attr-102436 li a[order-num="+c.orderNum+"]").parent("li").addClass("selected")}else{$("#pro-cate-attr-"+c.attributeId).find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-"+c.attributeId+" li a[order-num="+c.orderNum+"]").parent("li").addClass("selected")}}ec.product.prdAttrList=d};ec.product.renderSort=function(a,b){switch(a){case"0":break;case"2":$("#sort-2").addClass("sort-desc");break;default:$("#sort-"+a).addClass("sort-"+(b=="0"?"desc":"asc"));break}$("#sort-"+a).addClass("selected")};ec.product.post=function(d){var a=(d?d:1);var g=ec.product.cid;var f=ec.lang.json.stringify(ec.product.prdAttrList);document.getElementById("sortField").value=ec.product.sortField;document.getElementById("sortType").value=ec.product.sortType;document.getElementById("prdAttrList").value=f;var b="/list-"+g+"-"+a+"-"+ec.product.sortField+"-"+ec.product.sortType,e=[];if(ec.product.prdAttrList&&ec.product.prdAttrList.length>0){for(var c=0;c<ec.product.prdAttrList.length;c++){e.push(ec.product.prdAttrList[c].attributeId+"-"+ec.product.prdAttrList[c].orderNum)}b=b+"-"+e.join("-")}window.location=b};ec.product.arrival=function(a,b){ec.account.afterLogin(function(){ec.product.syncCustomSession();var d=ec.product.email;var c=ec.product.mobile;var f="";var e=new ec.box($("#product-arrival-html").val(),{boxid:"product-arriva-box",boxclass:"ol_box_4",title:"到货通知",showButton:false,onopen:function(g){if(ec.util.isEmpty(d)){$("#arrival-email").css({cursor:"pointer"});$("#arrival-email").click(function(){window.open("/member/account");ec.product.bind()});$("#arrival-email").attr("class","disabled");$("#account-email").html('未绑定安全邮箱&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')}else{$("#arrival-email").bind("click",function(){f=ec.product.chooseNoticeType("email")});$("#account-email").html(d)}if(ec.util.isEmpty(c)){$("#arrival-mobile").css({cursor:"pointer"});$("#arrival-mobile").click(function(){window.open("/member/account");ec.product.bind()});$("#arrival-mobile").attr("class","disabled");$("#account-mobile").html('未绑定安全手机&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')}else{$("#arrival-mobile").bind("click",function(){f=ec.product.chooseNoticeType("mobile")});$("#account-mobile").html(ec.product.splitMobile(c))}},onok:function(i){if(f.length==0){$("#arrival-error span").html("请选择一种通知方式！");$("#arrival-error").removeClass("hide");return}var h="1";var g=d;if(f=="mobile"){h="3";g=c}new ec.ajax().submit({url:"/product/arrivalMail.json",data:{informWay:g,type:h,skuId:a,skuCode:b},timeout:10000,timeoutFunction:function(){$("#arrival-error span").html("操作超时，请重试！");$("#arrival-error").removeClass("hide")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(j){if(!j.success){$("#arrival-error span").html(j.msg);$("#arrival-error").removeClass("hide");return}alert("设置成功！");$("#arrival-error").addClass("hide");i.close();$(".ol_box_mask").remove()}})},onclose:function(g){$(".ol_box_mask").remove()}});e.open();ec.product.bind=function(){e.close();$(".ol_box_mask").remove()}})};ec.product.chooseNoticeType=function(a){$("#arrival-email").removeClass("selected");$("#arrival-mobile").removeClass("selected");$("#arrival-"+a).attr("class","selected");return a};ec.product.splitMobile=function(b){var a="";for(var c=0;c<(b.length);c++){if((b.length-c)%4==0){a+="&nbsp;&nbsp;"}a+=b.substring(c,c+1)}return a};ec.product.syncCustomSession=function(){new ec.ajax().get({async:false,url:"/account/syncEmailAndMobile.json",timeout:10000,successFunction:function(a){if(!ec.util.isEmpty(a.customerInfo)){ec.product.email=a.customerInfo.email;ec.product.mobile=a.customerInfo.mobile}return},timeoutFunction:function(){return},errorFunction:function(){return}})};ec.product.disableAddCartButtons=function(a){$("#add-cat-"+a).attr("class","p-button-cart-disabled")};ec.product.enableAddCartButtons=function(a){$("#add-cat-"+a).attr("class","p-button-cart")};ec.product.addCart=function(b,e){ec.product.disableAddCartButtons(b);var c;var a=[];a[0]=b;var f=[];f[0]="";var d=[];d[0]=1;var g=[];g[0]=1;c={skuIds:a,extendSkuIds:f,quantity:g,type:d};ec.cart.add(c,{successFunction:function(h){ec.cart.getMicroCartBaseInfo(h.cart,function(i){var j=new ec.box($("#cart-tips").val(),{boxid:"product-cart-box",boxclass:"ol_box_4",showButton:false,onopen:function(p){$("#cart-briefName").html(e);var o=i.cartInfo;$("#cart-total, #header-cart-total").html(o.totalNumber);var l=0;var A=0;var s=0;for(var n=0;n<o.bundlerList.length;n++){var B=o.bundlerList[n];l+=B.originalPrice*B.quantity;s+=B.preferentialPrice}for(var v=0;v<o.productList.length;v++){var w=o.productList[v];var m=w.quantity;l+=w.ecshopPrice*m;s+=(w.ecshopPrice-w.skuPrice)*m;if(w.extendList.length>0){for(var u=0;u<w.extendList.length;u++){var r=w.extendList[u];var q=r.skuPrice;l+=q*m}}if(w.accidentList.length>0){for(var t=0;t<w.accidentList.length;t++){var k=w.accidentList[t];var q=k.skuPrice;l+=q*m}}}A=l-s;$("#cart-price").html(A.toFixed(2))},onok:function(k){ec.product.gotoshoppingCart()},oncancel:function(k){k.close();$(".ol_box_mask").remove()},onclose:function(k){$(".ol_box_mask").remove()}});j.open()});ec.product.enableAddCartButtons(b)},errorFunction:function(h){var i=new ec.box($("#popup-tips").val(),{boxid:"product-popup-box",boxclass:"ol_box_4",showButton:false,onopen:function(j){$("#popup-tips-msg").html(h.msg)},oncancel:function(j){j.close();$(".ol_box_mask").remove()},onclose:function(j){$(".ol_box_mask").remove()}});i.open();ec.product.enableAddCartButtons(b)}})};ec.product.removeAtrribute=function(b,c,a){return $.grep(b,function(e,d){return e[c]!=a})};