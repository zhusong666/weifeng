ec.pkg("ec.order");ec.load("ajax");ec.load("ec.box");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");ec.load("ec.linkSelect.region");var couponFreeCache={};ec.ready(function(){var a={UID:ec.util.cookie.get("uid"),TID:getPtid(),TIME:getTime(),CONTENT:{load:"1"}};ec.code.addAnalytics({hicloud:true});_paq.push(["trackLink","300040001","link",a]);$("#ec_ui_confirm").click(function(c){c=c||window.event;c.stopPropagation()});$(document).bind("click",function(d){var d=d||window.event;var c=d.target||d.srcElement;if(c.innerHTML!="\u5220\u9664"){$("#ec_ui_confirm").hide()}});var b=ec.form.validator.bind;if($("#orderType").val()==14||$("#orderType").val()==28){$("#order-address-mod").hide();$("#order-address-hr").hide();$("#peopleTelAddressID").hide()}else{eidtSelectAddressId="";ec.addr.list(ec.order.myAddress.load);$("#address-more .address-expand").click(function(){$("#order-address-list li:not(:last-child)").show();$(".address-expand").hide();$(".address-shrink").show()});$("#address-more .address-shrink").click(function(){if($("li[id^='myAddress'].current").index()>2){$("#order-address-list ul").prepend($("li[id^='myAddress'].current"))}$("#order-address-list li:gt(2)").hide();$(".address-expand").show();$(".address-shrink").hide()})}if($("#orderType").val()!=25&&$("#orderType").val()!=29){if($("#orderType").val()==0||$("#orderType").val()==26||$("#orderType").val()==30||$("#orderType").val()==18){ec.order.point.getOpt()}ec.order.huaban.getOpt()}$("#order-deliveryCharge").html(parseFloat(ec.order.deliveryCharge).toFixed(2))});var orderPromoPremiumsTpl=new ec.template(gid("order-promoPremiums-tpl").value);ec.order.computeDelieryFee=function(){var c;if(ec.order.balancePrice!=0){c=ec.order.realTotalPrice}else{c=(ec.order.totalOriginalPrice||0)-(ec.order.discountTotalPrice||0)}var f=$("#order-address-list li.current input[name='myAddress']");var b=f.attr("data-province"),h=f.attr("data-city"),g=f.attr("data-district"),a=ec.order.weight,e="/order/getDeliveryFee.json",d=$("#order-deliveryMethod").val();if(b!=undefined&&h!=undefined&&g!=undefined){new ec.ajax().get({url:e,data:{totalWeight:a,totalPrice:c-(ec.order.couponDiscount||0),deliveryMethod:d,province:b,city:h,district:g},timeout:10000,timeoutFunction:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(i){if(!i.success){ec.showError(i);return}$("#order-deliveryCharge").html(parseFloat(i.deliveryModeValue).toFixed(2));ec.order.deliveryCharge=parseFloat(i.deliveryModeValue);ec.order.newCount()}})}else{$("#order-deliveryCharge").html("0.00");ec.order.deliveryCharge=0;ec.order.newCount()}};ec.order.addCoupon2=function(){$("#coupon-code-div").hide();$("#couponCode2-report-errors").removeClass("report-errors").html("");var a=$.trim($("#couponCode2").val());if(!a||a.length<5||a.length>25){$("#couponCode2-report-errors").addClass("report-errors").html("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u4f18\u60e0\u5238\u7f16\u7801");return false}ec.order.addCoupon(a,{errorFunction:function(b){$("#couponCode2-report-errors").addClass("report-errors").html(b);$("#code_use_coupon_btn").addClass("disabled")},successFunction:function(){$("#code_use_coupon_btn").removeClass("disabled");$(".order-roll-explain").each(function(){if($(this).height()>18){$(this).addClass("order-roll-explain-more");$(this).children("a").removeClass("hide");$(this).bind("click",function(){if($(this).attr("class").indexOf("order-roll-explain-open")==-1){$(this).addClass("order-roll-explain-open")}else{$(this).removeClass("order-roll-explain-open")}})}})},type:"couponcode"})};ec.order.addCoupon=function(a,c){if(couponFreeCache[a]!=undefined&&couponFreeCache[a]!=""){var n=couponFreeCache[a];$("#order-couponCode").val(a);if(c.type&&"couponcode"==c.type){ec.order.couponRender(a,n);if(c.successFunction){c.successFunction()}}else{ec.order.showMsg(a,c,n)}return}var e=$("#order-state").val()||0;c=c||{};var f=$("#order-confirm-form");var q=$("input[name=orderReq]",f).val();var g=$("input[name=UIDesignID]",f).val();var k=$("input[name=sbs]",f).val();var j=$("input[name=types]",f).val();var m=$("input[name=qtys]",f).val();var i=$("input[name=css]",f).val();var l=$("input[name=ess]",f).val();var h=$("input[name=ass]",f).val();var b=$("#usePetalFlag").val();var p=$("#usePointFlag").val();var o=ec.order.getSelectAddress2();var r,d;if($("#orderType").val()==25){r={UIDesignID:g,sbs:k,qtys:m,css:i,ess:l,ass:h,usePetalEnable:b,usePointEnable:p,couponCode:a,regionId:o,sourceType:1};d="/order/queryPetalAndPoint4Made.json"}else{if($("#orderType").val()==18){r={couponCode:a,orderReqJson:q,regionId:o};d="/order/coupon/queryDepositInfo.json"}else{r={couponCode:a,state:e,orderReqJson:q,usePetalEnable:b,usePointEnable:p,regionId:o,routingTag:$("#orderType").val()};d="/order/coupon/queryInfobycart.json"}}if(d!=null&&r!=null){new ec.ajax().submit({url:d,timeout:10000,data:r,timeoutFunction:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(s){if(s.success){couponFreeCache[a]=s;if(c.type&&"couponcode"==c.type){ec.order.couponRender(a,s);if(c.successFunction){c.successFunction()}}else{$("#order-couponCode").val(a);ec.order.showMsg(a,c,s)}}else{var t=s.msg||"\u4f18\u60e0\u5238\u7f16\u7801\u9519\u8bef\u3002";ec.order.couponNotUse();if(c.errorFunction){c.errorFunction(t)}else{if(!c.couponInit){ec.order.ecboxOpen(t)}}}}})}return false};ec.order.showMsg=function(b,i,h){var g=h.cartInfo;if(h.promoPremiums&&h.promoPremiums.length>0){$("#premiumsList").html(orderPromoPremiumsTpl.parse("promoPremiums",h.promoPremiums)).show();$("#order-gift-area").show()}else{if(!gid("couponList")){$("#order-gift-area").hide()}$("#premiumsList").empty()}var e=parseFloat(h.couponDeduct).toFixed(2);var f=$("#orderType").val();if(f==18){if(e>ec.order.balancePrice){e=ec.order.balancePrice}if(null!=g.balanceAmount){$("#balanceAmountIDD").html(g.balanceAmount.toFixed(2))}}$("#order-couponDiscount").html(e);$("#couponSelfDeduct").html("-&yen;<em>"+e+"</em>");ec.order.couponDiscount=h.couponDeduct;if(i.type&&"coupon"==i.type){var a=$("#couponInfo").val();var d=a.split("|");var c='<span id="coupon-info-amount">'+d[2]+'</span>\uff0c<b id="b_yuan">-&yen;<span id="coupon-info-discount">'+parseFloat(h.couponDeduct).toFixed(2)+"</span></b>";$("#coupon-info-desc").html(c);if(d[0]==0){ec.order.computeDelieryFee()}else{$("#order-deliveryCharge").html("0.00");ec.order.deliveryCharge=0;ec.order.newCount()}}if(h.cartInfo.pointGift==null||h.cartInfo.pointGift==""||h.cartInfo.pointGift==0){$("#isHidePoint").hide();$("#canHavePoint").html("")}else{$("#isHidePoint").show();$("#canHavePoint").html(h.cartInfo.pointGift)}if(i.successFunction){i.successFunction()}};ec.order.couponRender=function(b,a){if(a.cartInfo.effectiveList){var c="";jQuery.each(a.cartInfo.effectiveList,function(h,d){if(b==d.couponCode){var f="";var l="";var m="";if((d.ruleType==1||d.amount!=null)&&d.deliveryFree==0){if(parseInt(d.amount)==d.amount){f="<span>"+parseInt(d.amount)+"</span><strong>\u4f18\u60e0\u5238</strong>"}else{f="<span>"+d.amount.toFixed(2)+"</span><strong>\u4f18\u60e0\u5238</strong>"}l="<em>&yen;</em>"}else{if((d.ruleType==2||d.discount!=null)&&d.deliveryFree==0){m=" order-roll-discount";f="<span>"+d.discount*10+"</span><b>\u6298</b>"}else{m=" order-roll-type";f="<span>\u514d\u90ae\u5238</span>"}}var j=d.couponName;var k=d.amount||0;var n=d.deliveryFree;var e=[];e.push('<div class="order-roll-info">');e.push(l);e.push('<div class="order-roll-price clearfix">');e.push(f);e.push("</div>");e.push('<p title="'+j+'" class="order-roll-word">'+j+"</p>");e.push("</div>");if(d.couponDes!=null){e.push('<p class="order-roll-explain">\u4f7f\u7528\u8981\u6c42\uff1a'+d.beginDate.substring(0,10).replaceAll("-",".")+" - "+d.endDate.substring(0,10).replaceAll("-",".")+"\uff0c"+d.couponDes)}else{e.push('<p class="order-roll-explain">\u4f7f\u7528\u8981\u6c42\uff1a'+d.beginDate.substring(0,10).replaceAll("-",".")+" - "+d.endDate.substring(0,10).replaceAll("-","."))}e.push('<a href="javascript:;" class="btn"></a> </p>');var d=e.join("");$("#li_coupon").html(d);$("#li_coupon").removeClass("order-roll-discount");$("#li_coupon").removeClass("order-roll-type");$("#li_coupon").addClass(m);$("#li_coupon").attr("code",b);var g=n+"|"+b+"|"+j+"|"+k;$("#li_coupon").attr("data",g);cache_coupon_by_inputCode={};cache_coupon_by_inputCode.coupon=d;cache_coupon_by_inputCode.code=b;cache_coupon_by_inputCode.data=g;cache_coupon_by_inputCode.couponStyle=m;$("#coupon-code-div").show();return}})}};ec.order.couponUse=function(b){if($(b).hasClass("disabled")){return}var a="";var c="";if($("#coupon_tab").attr("class")=="current"){cache_coupon_by_inputCode=null;a=$("#order-roll-coupon li.order-roll-detail.current").attr("id");c=$("#"+a).attr("data")}else{$("li[index^='effCouponInfo_']").removeClass("current");a=$("#li_coupon").attr("code");c=$("#li_coupon").attr("data")}$("#couponInfo").val(c);ec.order.addCoupon(a,{type:"coupon"});$("#coupon-edit-link").removeClass("hide");$("#coupon-use-link").addClass("hide");$(".ol_box_mask").addClass("hide");$("#order-coupon-box").addClass("hide")};ec.order.couponNotUse=function(){$("li[name^='effCouponInfo_']").removeClass("current");$("#li_coupon").removeClass("current");cache_coupon_by_inputCode=null;$("#order-couponCode").val("");$("#couponInfo").val("");ec.order.addCoupon("",{type:"couponNotuse"});ec.order.couponDiscount=0;ec.order.computeDelieryFee();$("#coupon-info-desc").html("");$("#coupon-edit-link").addClass("hide");$("#coupon-use-link").removeClass("hide")};ec.order.submit=function(){pushPostOrderMsg();if(28==$("#orderType").val()||14==$("#orderType").val()){ec.order.submitHua();return}if($("#order-address-list li").length==1){ec.order.noAddressBox();return false}if($("#order-address-list li.current").length==0){ec.order.addressNullTips();return false}noInvoice=false;noInvoicePos=1000000;$(".invoiceEdit").each(function(){if($(this).text()=="\u9009\u62e9\u53d1\u7968\u7c7b\u578b"){var e=$(this).offset().top-100;noInvoicePos=e<noInvoicePos?e:noInvoicePos;noInvoice=true}});if(noInvoice){ec.order.globalNullTips("\u8bf7\u9009\u62e9\u53d1\u7968",function(){$("html,body").animate({scrollTop:noInvoicePos},100);$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")});return}var b=$("#order-address-list li.current").find("#needL4Addr").val();var d=$("#order-address-list li.current").find("#needModify").val();if(d=="true"){ec.order.ecboxOpen("\u60a8\u7684\u6536\u8d27\u5730\u5740\u6709\u8bef,\u8bf7\u4fee\u6539\u6536\u8d27\u5730\u5740\u518d\u8bd5\uff01");return}$(".button-submit-order").removeClass("button-style-1").addClass("button-style-disabled-4");var a=$("#order-address-list li.current input[name='myAddress']").val();$("#order-confirm-form>#order-address").val(a);if($("#orderType").val()=="30"){$("#giftMessage").val("");if($("#giftMessageTip").length>0){$("#giftMessage").val($("#giftMessageTip").val())}if($("#orderType").val()==30&&$("#giftMessageTip").val()!=null&&$("#giftMessageTip").val()!=""){var c=/[^A-Za-z0-9\u3002.\uff1f?\uff01!\uff0c,\u3001\uff1b;\uff1a:\u201c\u201d\u2018\u2019\uff08 \uff09\[\]{}()\u2500\u2022\uff0e\u300a\u300b\u3008\u3009<>\u2014_*\u00d7\u25a1\/\u25b2\u25cf\uff5e~\u2026\u2192@#\uffe5%&\u2014\-=\s\r\n\u4e00-\u9fa5]/;if(c.test($("#giftMessageTip").val())){ec.order.ecboxOpen("\u795d\u8d3a\u8bed\u5b58\u5728\u975e\u6cd5\u5b57\u7b26\uff0c\u8bf7\u4fee\u6539\uff01");return}else{if($("#giftMessageTip").val().split("\n").length>6){ec.order.ecboxOpen("\u795d\u8d3a\u8bed\u6700\u591a\u5141\u8bb86\u884c\u6587\u5b57\uff0c\u8bf7\u4fee\u6539\uff01");return}}}}ec.order.invalidSubmitProduct()};ec.order.submitHua=function(){noInvoice=false;noInvoicePos=1000000;$(".invoiceEdit").each(function(){if($(this).text()=="\u9009\u62e9\u53d1\u7968\u7c7b\u578b"){var a=$(this).offset().top-100;noInvoicePos=a<noInvoicePos?a:noInvoicePos;noInvoice=true}});if(noInvoice){ec.order.globalNullTips("\u8bf7\u9009\u62e9\u53d1\u7968",function(){$("html,body").animate({scrollTop:noInvoicePos},100);$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")});return}$(".button-submit-order").removeClass("button-style-1").addClass("button-style-disabled-4");ec.order.invalidSubmitProduct()};var _huaban_tips=false;var _point_tips=false;ec.order.tips=function(){if(_huaban_tips||_point_tips){$("#order-discount-tip").show()}else{$("#order-discount-tip").hide()}};ec.order.huaban={toggle:function(){if(parseInt(ec.order.petalValidPetalTotal)<ec.order.huabanLowestUsage){$("#usePetalFlag").val("false");ec.order.petalAmount=0;$("#huaban_des").html("\u82b1\u74e3\u4f59\u989d&nbsp;"+ec.order.petalValidPetalTotal);$("#canUserPetal").html("\uff0c\u4e0d\u8db3"+ec.order.huabanLowestUsage+"\u4e0d\u53ef\u4f7f\u7528");$("#huaban-checkbox").attr("class","icon-choose-normal icon-choose-disabled");return}var a=$("#huaban-checkbox").attr("checked");if(a=="false"){a=true;$("#huaban_des").html("\u82b1\u74e3\u4f59\u989d&nbsp;"+ec.order.petalValidPetalTotal);$("#huaban-checkbox").attr("checked","true");$("#huaban-checkbox").attr("class","icon-choose-normal icon-choose")}else{a=false;$("#huaban_des").html("\u4f7f\u7528\u82b1\u74e3");$("#canUserPetal").html("");$("#huaban-checkbox").attr("checked","false");$("#huaban-checkbox").attr("class","icon-choose-normal")}if(a){$("#usePetalFlag").val("true")}else{$("#usePetalFlag").val("false")}if($("#orderType").val()==25){this.confirm4Made()}else{this.confirm()}},getOpt:function(a){var b=null;if(null==$("#order-deliveryCharge").html()){b=0}else{b=parseFloat($("#order-deliveryCharge").html().replace("\u00a5","").replace("&nbsp;",""),10)}new ec.ajax().get({url:"/query/petal/info.json",data:{orderPrice:parseFloat(ec.order.petalFlagTotalPrice,10)-b},timeout:10000,timeoutFunction:function(){},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(c){if(!c.success){return}c.validPetalTotal=parseInt(c.validPetalTotal,10);if(c.validPetalTotal>0){ec.order.petalValidPetalTotal=c.validPetalTotal}if(parseInt(ec.order.petalValidPetalTotal)<ec.order.huabanLowestUsage){$("#usePetalFlag").val("false");ec.order.petalAmount=0;$("#huaban_des").html("\u82b1\u74e3\u4f59\u989d&nbsp;"+ec.order.petalValidPetalTotal);$("#canUserPetal").html("\uff0c\u4e0d\u8db3"+ec.order.huabanLowestUsage+"\u4e0d\u53ef\u4f7f\u7528");$("#huaban-checkbox").attr("class","icon-choose-normal icon-choose-disabled");return}if(a&&ec.util.isFunction(a)){a.call(ec.order.huaban)}}})},confirm:function(m){var a=$("#order-state").val()||0;var n=$("#order-confirm-form");var j=$("input[name=sbs]",n).val();var g=$("input[name=types]",n).val();var h=$("input[name=qtys]",n).val();var l=$("input[name=ess]",n).val();var b=$("input[name=ass]",n).val();var i=$("input[name=orderReq]",n).val();var d=$("#usePetalFlag").val();var f=$("#usePointFlag").val();var c=$("#order-couponCode").val();var k=ec.order.getSelectAddress2();var e={state:a,orderReq:i,sbs:j,types:g,qtys:h,ess:l,ass:b,usePetalEnable:d,usePointEnable:f,couponCode:c,regionId:k,routingTag:$("#orderType").val()};new ec.ajax().submit({url:"/order/queryPetalAndPoint.json",timeout:10000,data:e,timeoutFunction:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(p){if(!p.success){var o=$("#huaban-checkbox").attr("checked");if(o&&o=="false"){$("#huaban-checkbox").attr("checked","true");$("#huaban-checkbox").addClass("icon-choose").removeClass("icon-choose-disabled")}else{$("#huaban-checkbox").attr("checked","false");$("#huaban-checkbox").removeClass("icon-choose").removeClass("icon-choose-disabled")}ec.order.ecboxOpen(p.msg);return}ec.order.huaban.showMsg(p);ec.order.tips()}})},confirm4Made:function(k){var m=$("#order-confirm-form");var l=$("input[name=UIDesignID]",m).val();var h=$("input[name=sbs]",m).val();var g=$("input[name=qtys]",m).val();var e=$("input[name=css]",m).val();var j=$("input[name=ess]",m).val();var a=$("input[name=ass]",m).val();var c=$("#usePetalFlag").val();var f=$("#usePointFlag").val();var b=$("#order-couponCode").val();var i=ec.order.getSelectAddress2();var d={UIDesignID:l,sbs:h,qtys:g,css:e,ess:j,ass:a,usePetalEnable:c,usePointEnable:f,couponCode:b,regionId:i,sourceType:0};new ec.ajax().submit({url:"/order/queryPetalAndPoint4Made.json",timeout:10000,data:d,timeoutFunction:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(o){if(!o.success){var n=$("#huaban-checkbox").attr("checked");if(n=="false"){$("#huaban-checkbox").attr("checked","true");$("#huaban-checkbox").addClass("icon-choose").removeClass("icon-choose-disabled")}else{$("#huaban-checkbox").attr("checked","false");$("#huaban-checkbox").removeClass("icon-choose").removeClass("icon-choose-disabled")}ec.order.ecboxOpen(o.msg);return}ec.order.huaban.showMsg(o)}})},reset:function(){var a=$("#order-price");a.html(a.attr("data-oldval"));$("#oreder-huaban-num").html("0.00");ec.order.petalAmount=0;ec.order.newCount()},showMsg:function(d){ec.order.petalPay=d.cartInfo.petalPay;ec.order.pointPay=d.cartInfo.pointPay;ec.order.pointConsumed=d.cartInfo.pointConsumed;ec.order.petalNum=d.cartInfo.petalNum;var e=$("#huaban-checkbox").attr("checked");var a=$("#point-checkbox").attr("checked");var b=$("#point-checkbox").attr("onclick");var c=parseInt($("#point-count").html());if(c!=ec.order.pointConsumed&&ec.order.pointConsumed!=0){_point_tips=true}else{_point_tips=false}if(ec.order.petalNum!=ec.order.petalValidPetalTotal&&ec.order.petalNum!=0){if(ec.order.petalValidPetalTotal>0){_huaban_tips=true}}else{_huaban_tips=false}if(e&&e=="true"){ec.order.petalAmount=d.cartInfo.petalPay;$("#canUserPetal").html('\uff0c\u4f7f\u7528<span id="huaban-max">'+ec.order.petalNum+'</span>\u82b1\u74e3\uff0c\u62b5<b id="point-plus">\u00a5'+parseFloat(ec.order.petalPay).toFixed(2)+"</b>")}else{ec.order.petalAmount=0}if(a&&a=="true"){ec.order.pointAmount=d.cartInfo.pointPay;$("#canUserPoint").html('\uff0c\u4f7f\u7528<span id="huaban-max">'+ec.order.pointConsumed+'</span>\u79ef\u5206\uff0c\u62b5<b id="point-plus">\u00a5'+parseFloat(ec.order.pointPay).toFixed(2)+"</b>")}else{ec.order.pointAmount=0}if(d.cartInfo.pointGift==null||d.cartInfo.pointGift==""||d.cartInfo.pointGift==0){$("#isHidePoint").hide();$("#canHavePoint").html("")}else{$("#isHidePoint").show();$("#canHavePoint").html(d.cartInfo.pointGift)}ec.order.huaban.count()},count:function(a){var b=ec.order.pointAmount;var e=ec.order.petalAmount;var d=$("#order-discountTotalPrice");var c=parseFloat($("#order-couponDiscount").html(),10);d.html((parseFloat(d.attr("data-oldVal"),10)+e+b+c).toFixed(2));$("#oreder-huaban-num").html((e).toFixed(2));$("#oreder-point-num").html((b).toFixed(2));ec.order.newCount()}};ec.order.point={toggle:function(){var a=$("#point-checkbox").attr("checked");if(a=="false"){a=true;$("#point-checkbox").attr("checked","true");$("#point-checkbox").attr("class","icon-choose-normal icon-choose")}else{a=false;$("#point-checkbox").attr("checked","false");$("#point-checkbox").attr("class","icon-choose-normal");$("#canUserPoint").html("")}if(a){$("#usePointFlag").val("true")}else{$("#usePointFlag").val("false")}if($("#orderType").val()==25){this.confirm4Made()}else{this.confirm()}},getOpt:function(a){var b=$("#point-count");$.ajax({url:openApiDomain+"/point/queryUserPointBalanceDetail.json",dataType:"jsonp",data:{ifHisDetail:"0"},timeout:10000,success:function(d){if(d.resultCode!="200000"){$("#point-checkbox").removeClass("icon-choose").addClass("icon-choose-disabled");return}d=d.data;var c=d.pointBlance;if(c>=100){if(d.status=="S"){$("#point-checkbox").removeClass("icon-choose").addClass("icon-choose-disabled");b.html(c+"<span>\uff08\u5df2\u51bb\u7ed3\uff09</span>");$("#point-checkbox").unbind("click")}else{$("#point-checkbox").removeClass("icon-choose").removeClass("icon-choose-disabled");b.html(c);$("#canUserPoint").html("\uff0c\u4f7f\u7528\u79ef\u5206");$("#point-checkbox").bind("click",function(){ec.order.point.toggle()})}}else{$("#canUserPoint").html("\uff0c\u4e0d\u8db3100\u4e0d\u53ef\u4f7f\u7528");$("#point-checkbox").unbind("click");$("#point-checkbox").removeClass("icon-choose").addClass("icon-choose-disabled");if(d.status=="S"){b.html(c+"<span>\uff08\u5df2\u51bb\u7ed3\uff09</span>")}else{b.html(c)}}if(a&&ec.util.isFunction(a)){a.call(ec.order.point)}}})},confirm:function(m){var b=$("#order-state").val()||0;var n=$("#order-confirm-form");var j=$("input[name=sbs]",n).val();var g=$("input[name=types]",n).val();var h=$("input[name=qtys]",n).val();var l=$("input[name=ess]",n).val();var i=$("input[name=orderReq]",n).val();var a=$("input[name=ass]",n).val();var d=$("#usePetalFlag").val();var f=$("#usePointFlag").val();var c=$("#order-couponCode").val();var k=ec.order.getSelectAddress2();var e={state:b,orderReq:i,sbs:j,types:g,qtys:h,ess:l,ass:a,usePetalEnable:d,usePointEnable:f,couponCode:c,regionId:k,routingTag:$("#orderType").val()};new ec.ajax().submit({url:"/order/queryPetalAndPoint.json",timeout:10000,data:e,timeoutFunction:function(){},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(p){if(!p.success){var o=$("#point-checkbox").attr("checked");if(o=="false"){$("#point-checkbox").attr("checked","true");$("#point-checkbox").addClass("icon-choose").removeClass("icon-choose-disabled")}else{$("#point-checkbox").attr("checked","false");$("#point-checkbox").removeClass("icon-choose").removeClass("icon-choose-disabled")}ec.order.ecboxOpen(p.msg);return}ec.order.point.showMsg(p);ec.order.tips()}})},confirm4Made:function(k){var m=$("#order-confirm-form");var l=$("input[name=UIDesignID]",m).val();var h=$("input[name=sbs]",m).val();var g=$("input[name=qtys]",m).val();var e=$("input[name=css]",m).val();var j=$("input[name=ess]",m).val();var a=$("input[name=ass]",m).val();var c=$("#usePetalFlag").val();var f=$("#usePointFlag").val();var b=$("#order-couponCode").val();var i=ec.order.getSelectAddress2();var d={UIDesignID:l,sbs:h,qtys:g,css:e,ess:j,ass:a,usePetalEnable:c,usePointEnable:f,couponCode:b,regionId:i,sourceType:0};new ec.ajax().submit({url:"/order/queryPetalAndPoint4Made.json",timeout:10000,data:d,timeoutFunction:function(){},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(o){if(!o.success){var n=$("#point-checkbox").attr("checked");if(n=="false"){$("#point-checkbox").attr("checked","true");$("#point-checkbox").addClass("icon-choose").removeClass("icon-choose-disabled")}else{$("#point-checkbox").attr("checked","false");$("#point-checkbox").removeClass("icon-choose").removeClass("icon-choose-disabled")}ec.order.ecboxOpen(o.msg);return}ec.order.point.showMsg(o)}})},reset:function(){var a=$("#order-price");a.html(a.attr("data-oldval"));$("#oreder-point-num").html("0.00");ec.order.pointAmount=0;ec.order.newCount()},showMsg:function(c){ec.order.petalPay=c.cartInfo.petalPay;ec.order.pointPay=c.cartInfo.pointPay;ec.order.pointConsumed=c.cartInfo.pointConsumed;ec.order.petalNum=c.cartInfo.petalNum;var b=parseInt($("#point-count").html());if(b!=ec.order.pointConsumed&&ec.order.pointConsumed!=0){_point_tips=true}else{_point_tips=false}if(ec.order.petalNum!=ec.order.petalValidPetalTotal&&ec.order.petalNum!=0){if(ec.order.petalValidPetalTotal>0){_huaban_tips=true}}else{_huaban_tips=false}var d=$("#huaban-checkbox").attr("checked");if(d&&d=="true"){ec.order.petalAmount=c.cartInfo.petalPay;$("#canUserPetal").html('\uff0c\u4f7f\u7528<span id="huaban-max">'+ec.order.petalNum+'</span>\u82b1\u74e3\uff0c\u62b5<b id="point-plus">\u00a5'+parseFloat(ec.order.petalPay).toFixed(2)+"</b>")}var a=$("#point-checkbox").attr("checked");if(a&&a=="true"){ec.order.pointAmount=c.cartInfo.pointPay;$("#canUserPoint").html('\uff0c\u4f7f\u7528<span id="point-max">'+ec.order.pointConsumed+'</span>\u79ef\u5206\uff0c\u62b5<b id="point-plus">\u00a5'+parseFloat(ec.order.pointPay).toFixed(2)+"</b>")}else{ec.order.pointAmount=0}if(c.cartInfo.pointGift==null||c.cartInfo.pointGift==""||c.cartInfo.pointGift==0){$("#isHidePoint").hide();$("#canHavePoint").html("")}else{$("#isHidePoint").show();$("#canHavePoint").html(c.cartInfo.pointGift)}ec.order.point.count()},count:function(a){var e=ec.order.petalAmount;var b=ec.order.pointAmount;var d=$("#order-discountTotalPrice");var c=parseFloat($("#order-couponDiscount").html(),10);d.html((parseFloat(d.attr("data-oldVal"),10)+e+b+c).toFixed(2));$("#oreder-point-num").html((b).toFixed(2));$("#oreder-huaban-num").html((e).toFixed(2));ec.order.newCount()}};ec.order.getSelectAddress2=function(){var a="";$("#order-address-list ul li").each(function(b){var c=$(this).attr("class");if("current"==c||"hide current"==c){var d=$(this).find("input[name='myAddress'").attr("data-id");a=ec.order.myAddress.districtList[d]}});return a};function publicMethod(){var a=$("#order-address-list").find("li");var c=$("#order-address-list").css("display");if(a!=null&&a.length>0&&c!="none"){for(var d=0;d<a.length;d++){if($(a[d]).hasClass("current")){var b=$(a[d]).attr("index");if(b){ec.order.myAddress.defaultId=b;$("#peopleID").html($("#consignee-name-"+b).html());$("#telID").html($("#consignee-tel-"+b).html());$("#addressID").html($("#address-detail-"+b).html());$("#peopleTelAddressID").show();$("#no-delivery-address-tips").hide()}else{$("#peopleID").html("");$("#telID").html("");$("#addressID").html("");$("#no-choose-address").text("\u672a\u9009\u62e9\u6536\u8d27\u5730\u5740\u4e0d\u53ef\u4e0b\u5355");$("#link-choose-address").text("\u70b9\u51fb\u9009\u62e9");$("#link-choose-address").unbind("click");$("#peopleTelAddressID").hide();$("#no-delivery-address-tips").show()}break}else{$("#peopleID").html("");$("#telID").html("");$("#addressID").html("");if(a.length==1){$("#no-choose-address").text("\u65e0\u6536\u8d27\u5730\u5740\u4e0d\u53ef\u4e0b\u5355");$("#link-choose-address").text("\u70b9\u51fb\u586b\u5145");$("#link-choose-address").bind("click",function(){ec.order.myAddress.add()});$("#no-delivery-address-tips").show();$("#peopleTelAddressID").hide();break}else{$("#no-choose-address").text("\u672a\u9009\u62e9\u6536\u8d27\u5730\u5740\u4e0d\u53ef\u4e0b\u5355");$("#link-choose-address").text("\u70b9\u51fb\u9009\u62e9");$("#link-choose-address").unbind("click");$("#peopleTelAddressID").hide();$("#no-delivery-address-tips").show()}}}}else{$("#peopleID").html("");$("#telID").html("");$("#addressID").html("");$("#peopleTelAddressID").show();$("#no-delivery-address-tips").hide()}}var eidtSelectAddressId="";ec.order.myAddress={list:{},districtList:{},length:function(){var c=ec.order.myAddress.list,b,a=0;for(b in c){a=a+1}return a},defaultId:null,defaultAddrId:null,curId:null,curType:null,load:function(c,a,h){var k=c,l,s,g=[],u=ec.order.myAddress;var e,f;$("#randomFlag").val(a);l=k.length;if(l>3){$(".address-expand").show();$(".address-shrink").hide()}else{$(".address-expand").hide();$(".address-shrink").hide()}for(s=0;s<l;s++){u.list[k[s].id]=k[s];u.districtList[k[s].id]=k[s].province+"|"+k[s].city+"|"+k[s].district;var d=$.extend({},k[s]);for(var t in d){d[t]=ec.util.escapeHtml(d[t])}if(s>2){g.push('<li id="myAddress-'+d.id+'" index="'+d.id+'" class="hide">')}else{if(d.defaultFlag==1){g.push('<li id="myAddress-'+d.id+'" index="'+d.id+'" class="current">')}else{g.push('<li id="myAddress-'+d.id+'" index="'+d.id+'">')}}g.push('<div class="address-supplement hide"><a href="javascript:;" onclick="ec.order.myAddress.edit('+d.id+')" class="address-add-btn">');if(d.needModify==true){g.push("\u8bf7\u60a8\u6838\u5b9e\u5730\u5740")}else{g.push("\u5b8c\u5584\u8857\u9053\u4fe1\u606f")}g.push("</a></div>");if(d.defaultFlag==1){g.push('<span id="defaultAddress-'+d.id+'" class="address-status">\u9ed8\u8ba4\u5730\u5740</span>')}else{g.push('<span id="defaultAddress-'+d.id+'" class="address-status hide">\u9ed8\u8ba4\u5730\u5740</span>')}g.push('<div class="address-main" onclick="ec.order.myAddress.select(this);">');g.push('<p class="clearfix">');g.push('<b id="consignee-name-'+d.id+'">'+d.consignee+"</b>");g.push('<span id="consignee-tel-'+d.id+'">');if(d.mobile&&d.mobile.length>0){g.push(d.mobile)}else{g.push(d.phone)}g.push("</span>");g.push("</p>");g.push('<div class="address-detail" id="address-detail-'+d.id+'">');var j="";if(d.streetName!=null&&d.streetName!=""){j=d.streetName}if(d.provinceName==null){d.provinceName="  "}if(d.cityName==null){d.cityName="  "}if(d.districtName==null){d.districtName="  "}g.push(d.provinceName+"&nbsp;"+d.cityName+"&nbsp;"+d.districtName+"&nbsp;"+j+"&nbsp;"+d.address);g.push("</div>");g.push("</div>");g.push('<input type="hidden" id="needL4Addr" value="'+d.needL4Addr+'" />');g.push('<input type="hidden" id="needModify" value="'+d.needModify+'" />');g.push('<input type="hidden" name="streetName" value="'+j+'" />');g.push('<input type="hidden" name="myAddress" id="input-myAddress'+d.id+'" data-province="'+d.province+'" data-city="'+d.city+'" data-district="'+d.district+'" data-id="'+d.id+'" value="'+d.id+'" />');g.push('<div class="address-sub">');g.push('<a class="address-edit" href="javascript:;" onclick="ec.order.myAddress.edit('+d.id+')">\u7f16\u8f91</a>');g.push('<a class="address-del"  href="javascript:;" onclick="ec.order.myAddress.del(this,'+d.id+')">\u5220\u9664</a>');if(d.defaultFlag==1){haveDefaultFlag=true;u.defaultId=d.id;u.defaultAddrId=d.id;e=d.id;f=d.district;g.push('<a id="setAddress-'+d.id+'" class="address-default hide" href="javascript:;" onclick="ec.order.myAddress.setDetault('+d.id+')">\u8bbe\u4e3a\u9ed8\u8ba4</a>')}else{u.defaultId=null;g.push('<a id="setAddress-'+d.id+'" class="address-default" href="javascript:;" onclick="ec.order.myAddress.setDetault('+d.id+')">\u8bbe\u4e3a\u9ed8\u8ba4</a>')}g.push("</div>");g.push("</li>")}if(l<3){g.push('<li id="address-empty">');$("#upAddAddressButton").hide()}else{g.push('<li id="address-empty" class="hide">');$("#upAddAddressButton").show()}g.push('<div class="address-empty">');g.push('<a href="javascript:;" class="address-add-btn" onclick="ec.order.myAddress.add()">');g.push("\u65b0\u589e\u6536\u8d27\u5730\u5740");g.push("</a>");g.push("</div>");g.push("</li>");$("#order-address-list > ul").html(g.join("")).show();var r=false;var b=$("#order-address-list input[name='myAddress']");for(var o=0;o<b.length;o++){var m=b[o];if(m.checked){e=$(m).attr("data-id");f=$(m).attr("data-district");r=true}}if(eidtSelectAddressId!=""){$("#order-address-list ul").prepend($("#myAddress-"+eidtSelectAddressId));$("#order-address-list li:gt(2)").hide();$("#order-address-list li:lt(3)").show();$("#myAddress-"+eidtSelectAddressId).addClass("current").siblings().removeClass("current")}u.init();if($("#order-address-list li.current input[id='needL4Addr']").val()=="true"){$("#order-address-list li.current").find(".address-supplement").show();$("#order-address-list li.current").find(".address-main").addClass("disabled");$("#order-address-list li.current").find(".address-sub").addClass("address-shield")}if($("#order-address-list li.current input[id='needModify']").val()=="true"){$("#order-address-list li.current").find(".address-supplement").show();$("#order-address-list li.current").find(".address-main").addClass("disabled");$("#order-address-list li.current").find(".address-sub").addClass("address-shield")}var n=$("#order-address-list li.current input[name='myAddress']").attr("data-id");var q=$("#order-address-list li.current input[name='myAddress']").attr("data-district");ec.order.selectAddress(n,q)},init:function(){var a,c,b=ec.order.myAddress;if(b.curType=="add"){}else{if(b.curType=="update"){}else{$("#order-address-list li:gt(2)").hide();$("#order-address-list li:lt(3)").show()}}publicMethod();$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")},isChange:function(d,c){var a,b;for(b in c){a=(d[b]==null||!d[b])?"":$.trim(d[b]);if($.trim(c[b])!=a){return true;break}}return false},isChange:function(d,c){var a,b;for(b in c){a=(d[b]==null||!d[b])?"":$.trim(d[b]);if($.trim(c[b])!=a){return true;break}}return false},indexOf:function(e,c){var a,f;if(c){for(var b in e){a=0;f=0;for(var d in c){if($.trim(c[d])===$.trim(e[b][d])){f+=1}a+=1}if(f==a){return b}}}return false},add:function(){$("#myAddress-edit-new-box").remove();$("#order-invoice-edit").remove();var a=ec.order.myAddress;ec.address.defaultTabValue();ec.address.cleanValue();ec.address.processType="0";a.box=new ec.box('<div id="order-address-add-area"></div>',{boxid:"myAddress-add-new-box",boxclass:"ol_box_4",width:800,title:"\u6dfb\u52a0\u5730\u5740",showButton:false,onopen:function(c){var b=$("#order-address-add-area"),d=$("#randomFlag").val();b.html(ec.order.getAddressBox());b.find("form").attr("data-type","add");b.find("input[name='randomFlag']").val(d);$("#myAddress-msg").removeClass("icon-error");ec.order.myAddress.bind(b);ec.address.bindSeelctEvent();c.setPosition()}}).open()},edit:function(c){$("#myAddress-add-new-box").remove();$("#order-invoice-edit").remove();ec.address.defaultTabValue();ec.address.cleanValue();var b=ec.order.myAddress,a=b.list[c];b.box=new ec.box('<div id="order-address-edit-area"></div>',{boxid:"myAddress-edit-new-box",boxclass:"ol_box_4",width:800,title:"\u4fee\u6539\u5730\u5740",showButton:false,onopen:function(e){var d=$("#order-address-edit-area"),g=$("#randomFlag").val();d.html(ec.order.getAddressBox());d.find("input[name='id']").val(a.id);d.find("input[name='consignee']").val(a.consignee);d.find("textarea[name='address']").val(a.address);d.find("input[name='zipCode']").val(a.zipCode);d.find("input[name='mobile']").val(a.mobile);d.find("input[name='phone']").val(a.phone);$("#myAddress-msg").removeClass("icon-error");var f="";if(a.street!=""&&a.street!=null){f=a.street}else{f=a.district}ec.order.myAddress.bind(d);ec.address.bindSeelctEvent();e.setPosition();ec.address.setValue(a);ec.address.processType="0";ec.address.queryData(ec.address.parseUrl(tree_url,f),true,1,ec.address.getCitydistrict)}}).open()},addData:function(a){return{id:$.trim(a.find("input[name='id']").val()),consignee:$.trim(a.find("input[name=consignee]").val()),provinceName:a.find("input[name='province']").html(),cityName:a.find("input[name='city']").html(),districtName:a.find("input[name='district']").html(),district:a.find("input[name='district']").val(),street:a.find("input[name='street']").val(),address:$.trim(a.find("textarea[name='address']").val()),zipCode:$.trim(a.find("input[name='zipCode']").val()),mobile:$.trim(a.find("input[name='mobile']").val()),phone:$.trim(a.find("input[name='phone']").val())}},save:function(f){var c=$(f).closest("form"),b="update",d=ec.order.myAddress,e=c.find("input[name='id']").val(),a=d.addData(c);ec.addr.syncCache(c);a=d.addData(c);province=c.find("input[name='province']").val(),city=c.find("input[name='city']").val(),district=c.find("input[name='district']").val(),street=c.find("input[name='street']").val();if(e&&d.list[e]){if(!d.isChange(d.list[e],a)){ec.order.myAddress.box.close();return}}if(d.indexOf(d.list,a)>0){c.find(".box-form-tips span").addClass("icon-error").html("\u5df2\u5b58\u5728\u6b64\u5730\u5740");return}if(c.attr("data-type")=="add"){b="add";d.curId=null;d.curType="add"}else{d.curId=c.find("input[name=id]").val();d.curType="update"}ec.addr.save(c,{type:b,successFunction:function(g,h){eidtSelectAddressId=g.id;ec.order.myAddress.box.close();ec.addr.list(ec.order.myAddress.load);if(ec.order.shopCode!=undefined){if(ec.order.isProxySale=="true"){ec.order.queryPayDelivery(eidtSelectAddressId,district)}else{ec.order.computeDelieryFee()}}else{ec.order.queryPayDelivery(eidtSelectAddressId,district)}}});return false},cancel:function(){ec.order.myAddress.box.close()},setDetault:function(a){ec.addr.setDefault(a,{successFunction:function(){$("#myAddress-"+a).find(".address-status").removeClass("hide");$("#myAddress-"+a).find(".address-default").hide();$("#order-address-list").find("li").each(function(){var c=$(this).attr("id");var b="myAddress-"+a;if(c!=b){c=c.substring(10);$("#myAddress-"+c).find(".address-status").addClass("hide");$("#myAddress-"+c).find(".address-default").show()}})}})},del:function(a,b){if(!ec.ui.confirm(a,"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5730\u5740\u5417\uff1f")){return}ec.addr.del(b,{successFunction:function(f){var d=ec.order.myAddress.list;if(d[f]!=null){delete d[f]}ec.order.myAddress.districtList[f]=null;ec.order.myAddress.curType="";ec.order.myAddress.defaultId=null;var c=$("#myAddress-"+f).index();if(c<3){$("#order-address-list li:eq(3)").show()}$("#myAddress-"+f).remove();publicMethod();if($("#order-address-list li").length<4){$("#upAddAddressButton").hide();$("#address-empty").show()}else{$("#upAddAddressButton").show();$("#address-empty").hide()}if($("#order-address-list li").length<5){$("#address-more .address-expand").hide();$("#address-more .address-shrink").hide()}var f="";var e="";if($("#order-address-list li.current").length==0){if($("span[id^='defaultAddress-']:not(.hide)").length==1){$("span[id^='defaultAddress-']:not(.hide)").parent().addClass("current");f=$("#order-address-list li.current input[name='myAddress']").attr("data-id");e=$("#order-address-list li.current input[name='myAddress']").attr("data-district");ec.order.selectAddress(f,e)}}if(ec.order.shopCode!=undefined){if(ec.order.isProxySale=="true"){ec.order.queryPayDelivery(f,e)}else{ec.order.computeDelieryFee()}}else{ec.order.queryPayDelivery(f,e)}}})},bind:function(d){var f=ec.form.validator.bind,b=d.find("textarea[name=address]"),a=d.find("input[name=phone]"),c=d.find("input[name=mobile]"),e=function(h,g){var h=(h.attr("name")==="mobile")?c:a;var i=$(g.msg_ct);if($.trim(c.val()).length==0){c.addClass("error");$(i).addClass("icon-error");$(i).text("\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a")}else{if($.trim(h.val()).length>0&&h.hasClass("error")){return}else{if(c.hasClass("error")){$(i).text("\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\u7801\uff0c\u4f8b\u5982\uff1a13XXXXXXXXX")}if(a.hasClass("error")){$(i).text("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5907\u9009\u53f7\u7801\uff0c\u56fa\u8bdd\u683c\u5f0f\u4e3a\u533a\u53f7-\u4e3b\u673a-\u5206\u673a\u53f7")}if(!c.hasClass("error")&&!a.hasClass("error")){$(i).removeClass("icon-error");$(i).text("")}}}};f(d.find("input[name=consignee]"),{type:["require","length","regex"],validOnChange:true,regex:/^[\uFF21-\uFF3A\uFF41-\uFF5A\u4E00-\u9FA5\s\u3000A-Za-z]+$/,min:2,max:20,msg_ct:d.find("#consignee-msg"),msg:{length:"\u6536\u8d27\u4eba\u957f\u5ea6\u4e3a2-20\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",regex:"\u6536\u8d27\u4eba\u53ea\u80fd\u586b\u5199\u4e2d\u6587\u548c\u82f1\u6587\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u6536\u8d27\u4eba"}});f(d.find("input[name=district]"),{type:["addressConfirmCheck"],validOnChange:true,msg_ct:$("#myAddress-msg"),msg:{addressConfirmCheck:"\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f"}});f(b,{type:["require","length","forbidChar2"],validOnChange:true,max:100,msg_ct:d.find("#address-msg"),msg:{forbidChar2:"\u6536\u8d27\u4eba\u8be6\u7ec6\u5730\u5740\u4e2d\u542b\u6709\u975e\u6cd5\u5b57\u7b26",length:"\u8be6\u7ec6\u5730\u5740\u6700\u957f\u4e3a100\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740"}});f(a,{type:["mobleOrPhone"],validOnChange:true,msg_ct:d.find("#phone-msg"),msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5907\u9009\u53f7\u7801\uff0c\u56fa\u8bdd\u683c\u5f0f\u4e3a\u533a\u53f7-\u4e3b\u673a-\u5206\u673a\u53f7"},successFunction:e});f(c,{type:["mobile"],validOnChange:true,msg_ct:d.find("#phone-msg"),msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\u7801\uff0c\u4f8b\u5982\uff1a13XXXXXXXXX"},successFunction:e});ec.form.input.label(b,"\u5982\u9009\u62e9\u4e0d\u5230\u60a8\u7684\u5730\u533a\uff0c\u8bf7\u5728\u6b64\u5904\u8be6\u7ec6\u63cf\u8ff0").label(a,"\u56fa\u8bdd\u6216\u5176\u4ed6\u624b\u673a\u53f7\u7801").label(c,"\u8bf7\u8f93\u516511\u4f4d\u624b\u673a\u53f7\u7801");d.find("input").change(function(){d.find(".box-form-tips span").html("").attr("class","")});d.find("textarea").change(function(){d.find(".box-form-tips span").html("").attr("class","")})},select:function(b){$(b).parent().addClass("current").siblings().removeClass("current");var e=$(b).siblings("input[name='myAddress']").attr("data-id");var c=$(b).siblings("input[name='myAddress']").attr("data-district");if(ec.order.shopCode!=undefined){if(ec.order.isProxySale=="true"){ec.order.queryPayDelivery(e,c)}else{ec.order.computeDelieryFee()}}else{ec.order.queryPayDelivery(e,c)}ec.order.selectAddress(e,c);var a=$(b).siblings("#needL4Addr").val();var d=$(b).siblings("#needModify").val();if(a=="true"){$(b).siblings(".address-supplement").show();$(b).addClass("disabled");$(b).siblings(".address-sub").addClass("address-shield")}if(d=="true"){$(b).siblings(".address-supplement").show();$(b).addClass("disabled");$(b).siblings(".address-sub").addClass("address-shield")}$(b).parent().siblings().find(".address-supplement").hide();$(b).parent().siblings().find(".address-main").removeClass("disabled");$(b).parent().siblings().find(".address-sub").removeClass("address-shield");publicMethod()}};ec.order.queryPayDelivery=function(e,d){var a=$("#input-couponCode");var c;var b;ec.order.myAddress.defaultId=e;if(a.val()){c=ec.order.weight+(parseFloat(a.attr("data-weight"))||0);b=a.attr("data-totalprice")||0}else{c=ec.order.weight;b=ec.order.price}$("#order-district").val(d);ec.order.loadDeliery({id:e,district:d,weight:c,price:b})};ec.order.loadDeliery=function(m){var g=$("#order-address-list li.current input[name=myAddress]"),b=m.id||g.attr("data-id"),k=m.district||$("#order-district").val(),e=m.weight||ec.order.weight,c=m.isDeliveryFree||ec.order.isDeliveryFree,n=$("#wareHouseId").val();realPrice=ec.order.realTotalPrice;var p=$("#order-confirm-form");var l=ec.order.getSelectAddress2();var i=$("input[name=orderReq]",p).val();var d=$("#usePetalFlag").val();var f=$("#usePointFlag").val();var o=$("input[name=UIDesignID]",p).val();var j=$("input[name=sbs]",p).val();titleTypes=[];$(".order-titleType").each(function(){var q=$(this);titleTypes.push(q.attr("id").replace("order-titleType","")+":"+q.attr("value"))});var a="";var h=$("#orderType").val();a="/order/queryPayDelieryTemp.json?sbs="+j+"&orderType="+h+"&orderReq="+i+"&id="+b+"&districtId="+k;ec.order.queryPayDeliery(a)};ec.order.queryPayDeliery=function(a){new ec.ajax().get({url:a,timeout:100000000,timeoutFunction:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(e){if(!e.success){ec.showError(e);return}var h=e.maps;var f=0;var c=0;var b=0;if(h!=null&&h!=""){for(var d in h){c++;if(h[d]!=null&&h[d]!=""){b=h[d].substring(h[d].indexOf("&")+1);h[d]=h[d].substring(0,h[d].indexOf("&"))}if(h[d]=="12"){$("#"+d).parent().find("div").remove();$("#"+d).after("<div class='report-errors'>\u6b64\u5546\u54c1\u6682\u4e0d\u652f\u6301\u8be5\u5730\u533a\u7684\u914d\u9001</div>");$("#"+d).parent().parent().addClass("disabled");$("#"+d).parent().parent().parent().addClass("disabled");if(d.indexOf("-")>-1){}else{$("#"+d).parent().parent().parent().parent().find("ul").addClass("disabled")}}if(h[d]=="6"){$("#"+d).parent().find("div").remove();$("#"+d).after("<div class='report-errors'>\u6b64\u5546\u54c1\u6682\u65f6\u7f3a\u8d27</div>");$("#"+d).parent().parent().addClass("disabled");$("#"+d).parent().parent().parent().addClass("disabled")}if(h[d]=="1"||h[d]=="2"||h[d]=="3"||h[d]=="4"||h[d]=="5"){$("#"+d).parent().find("div").remove();$("#"+d).after("<div class='report-errors'>\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70</div>");$("#"+d).parent().parent().addClass("disabled");$("#"+d).parent().parent().parent().addClass("disabled")}if(h[d]=="7"||h[d]=="8"){$("#"+d).parent().find("div").remove();$("#"+d).after("<div class='report-errors'>\u9650\u8d2d"+b+"\u4ef6</div>");$("#"+d).parent().parent().addClass("disabled");$("#"+d).parent().parent().parent().addClass("disabled")}if(h[d]=="0"){$("#"+d).parent().find("div").remove();$("#"+d).parent().parent().removeClass("disabled");$("#"+d).parent().parent().parent().removeClass("disabled");if(d.indexOf("-")>-1){var g=d.substring(0,d.indexOf("-"));if(h[g]=="12"){$("#"+d).parent().parent().addClass("disabled");$("#"+d).parent().parent().parent().addClass("disabled")}}else{$("#"+d).parent().parent().parent().parent().find("ul").removeClass("disabled")}f++}}if(f==c){ec.order.computeDelieryFee()}}}})};var cache_coupon_by_inputCode=null;ec.order.openPopWindow=function(f,e,b,a,g){var c=new ec.box($("#"+f).val(),{boxclass:"ol_box_4",boxid:e,title:g,width:b,modal:true,showButton:false,autoHeight:false,height:a,onok:function(h){h.close()}}).open();if("order-coupon-tpl"==f){var d=$("#order-couponCode").val();if(d==""){$("#code_use_coupon_btn").unbind("click");$("#code_use_coupon_btn").addClass("disabled");$("#use_coupon_btn").unbind("click");$("#use_coupon_btn").addClass("disabled");$("li[index^='effCouponInfo_']").removeClass("current")}else{if(cache_coupon_by_inputCode){$("#li_coupon").addClass("current");$("li[index^='effCouponInfo_']").removeClass("current")}else{$("#"+d).addClass("current").siblings().removeClass("current")}}if(cache_coupon_by_inputCode){$("#li_coupon").html(cache_coupon_by_inputCode.coupon);$("#li_coupon").attr("code",cache_coupon_by_inputCode.code);$("#li_coupon").attr("data",cache_coupon_by_inputCode.data);$("#li_coupon").removeClass("order-roll-discount");$("#li_coupon").removeClass("order-roll-type");$("#li_coupon").addClass(cache_coupon_by_inputCode.couponStyle);$("#couponCode2").val(cache_coupon_by_inputCode.code);ec.order.couponTabChange("coupon_code_tab");$("#code_use_coupon_btn").removeClass("disabled");$("#coupon-code-div").show()}$(".order-roll-explain").each(function(){if($(this).height()>18){$(this).addClass("order-roll-explain-more");$(this).children("a").removeClass("hide");$(this).bind("click",function(){if($(this).attr("class").indexOf("order-roll-explain-open")==-1){$(this).addClass("order-roll-explain-open")}else{$(this).removeClass("order-roll-explain-open")}})}})}};ec.order.invalidProduct=function(a){ec.order.invalidProduct.box=new ec.box('<div id="order-invalid-product"></div>',{boxid:"order-invalid-product-box",boxclass:"ol_box_4",width:700,height:500,title:"",showButton:false,onopen:function(c){var b=$("#order-invalid-product");b.html(ec.order.invalidProductBox(a));c.setPosition()}}).open()};ec.order.noAddressBox=function(){var a=[];a.push('<div class="box-content" style="height: auto;">');a.push('    <div class="box-prompt01-error">');a.push('<div class="h">');a.push("     <i></i>");a.push("</div>");a.push('<div class="b">');a.push("   <p>\u8981\u9001\u5230\u54ea\u91cc\u5462\uff1f\u8bf7\u5148\u586b\u5199\u6536\u8d27\u5730\u5740\u5427~</p>");a.push(" </div>");a.push("</div>");a.push('<div class="box-button">');a.push(' <a href="javascript:;" class="box-ok" onclick="ec.order.scrollTopAddress();"><span>\u786e\u5b9a</span></a>');a.push("</div>");a.push("</div>");ec.order.noAddressBox.box=new ec.box(a.join(" "),{boxid:"no-write-address-box",boxclass:"ol_box_4",width:600,height:230,title:"",showButton:false,onopen:function(b){b.setPosition()},onclose:function(){$("html,body").animate({scrollTop:$("#order-address-list ul").offset().top-100},100)}}).open()};ec.order.scrollTopAddress=function(){$("html,body").animate({scrollTop:$("#order-address-list ul").offset().top-100},100)};ec.order.noProduct=function(){var a=[];a.push('<div class="box-content" style="height: auto;">');a.push('    <div class="box-prompt01-error">');a.push('<div class="h">');a.push("     <i></i>");a.push("</div>");a.push('<div class="b">');if($("#orderType").val()==30){a.push('   <p id="success-message">\u90e8\u5206\u5546\u54c1\u6682\u4e0d\u53ef\u8d2d\u4e70</p>')}else{a.push('   <p id="success-message">\u5168\u90e8\u5546\u54c1\u5747\u4e0d\u53ef\u8d2d\u4e70</p>')}a.push(" </div>");a.push("</div>");a.push('<div class="box-button">');a.push(' <a href="javascript:;" class="box-ok" onclick="ec.order.goBack();"><span>\u8fd4\u56de\u4e0a\u4e00\u9875</span></a>');a.push("</div>");a.push("</div>");new ec.box(a.join(" "),{boxid:"no_product_tips",boxclass:"ol_box_4",width:600,height:230,title:"",showButton:false,onopen:function(b){b.setPosition()}}).open()};ec.order.invalidSubmitProduct=function(){var h=$("#orderType").val();var k=$("input[name='UIDesignID']").val();var i=$("input[name='sbs']").val();var d=$("input[name='css']").val();var e=$("input[name='qtys']").val();var j=$("input[name='ess']").val();var a=$("input[name='ass']").val();var f=$("input[name='consigneeAddressId']").val();var c=$("input[name='couponCode']").val();var g=$("input[name='orderReq']").val();var b=$("input[name='imeiCode']").val();if(h=="25"){data={UIDesignID:k,sbs:i,css:d,qtys:e,ess:j,ass:a,orderType:h,addressId:f,couponCode:c}}else{data={orderReq:g,orderType:h,addressId:f,couponCode:c,imeiCode:b}}$.ajax({url:"/order/validateOrder.json",timeout:10000,type:"POST",data:data,success:function(n){var n=ec.lang.json.parse(n);if(!n.success){if(n.errorCode=="noProduct"){ec.order.noProduct();return}else{if(n.errorCode=="addressError"){if(n.msg!=""&&n.msg!=undefined&&n.msg!=null){ec.order.ecboxOpen(n.msg)}else{ec.order.ecboxOpen("\u60a8\u7684\u6536\u8d27\u5730\u5740\u6709\u8bef,\u8bf7\u4fee\u6539\u6536\u8d27\u5730\u5740\u518d\u8bd5\uff01")}return}else{if(n.errorCode=="errorMsg"){ec.order.ecboxOpen(n.msg);return}else{var m="";m+='<input name="errorCode" type="text" value=\''+n.errorCode+"'>";m+='<input name="errorMsg" type="text" value="'+n.msg+'">';var l=$('<form action="/order/validateForward" method="post"></form>');l.append(m);$("body").append(l);l.submit()}}}}if(ec.lang.json.parse(n.invalidProductList).length>0){ec.order.invalidProduct(ec.lang.json.parse(n.invalidProductList));$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")}else{setTimeout(function(){gid("order-confirm-form").submit()},500)}},error:function(){ec.order.ecboxOpen("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")}})};ec.order.removeProduct=function(){var m=ec.lang.json.parse($("input[name='orderReq']").val());if(m&&m.length>0){for(var g=0;g<m.length;g++){if(!m[g]){m.splice(g,1)}if(m[g]&&m[g].gifts){for(var f=0;f<m[g].gifts.length;f++){if(!m[g].gifts[f]){m[g].gifts.splice(f,1)}}if(m[g].gifts.length==0){delete m[g].gifts}}}}$("#order-no-list ul input[name^='main']").each(function(){if(m!=null&&m.length>0){for(var j=0;j<m.length;j++){if(m[j].itemId==this.value){m.splice(j,1)}}}});$("#order-no-list ul input[name^='sub']").each(function(){if(this.value==$("input[name='ess']").val()){$("input[name='ess']").val("")}else{if(this.value==$("input[name='ass']").val()){$("input[name='ass']").val("")}}if(m!=null&&m.length>0){for(var r=0;r<m.length;r++){if(m[r].subOrderItemReqArgs!=null&&m[r].subOrderItemReqArgs.length>0){for(var k=0;k<m[r].subOrderItemReqArgs.length;k++){if(m[r].subOrderItemReqArgs[k].itemId==this.value&&m[r].itemId==$(this).attr("data-mainCode")){m[r].subOrderItemReqArgs.splice(k,1)}}}}}});$("#order-no-list ul input[name^='sbomCode']").each(function(){if(m!=null&&m.length>0){for(var s=0;s<m.length;s++){if(m[s].gifts!=null){if((m[s].itemType=="S0"||m[s].itemType=="P")&&m[s].gifts.length>0){for(var r=0;r<m[s].gifts.length;r++){if(m[s].gifts[r].sbomCode==this.value&&m[s].itemId==$(this).attr("data-mainCode")){m[s].gifts.splice(r,1)}}}}}}});for(var g=0;g<m.length;g++){if(m[g].gifts!=null&&m[g].gifts.length==0){delete m[g].gifts}if(m[g].subOrderItemReqArgs!=null&&m[g].subOrderItemReqArgs.length==0){delete m[g].subOrderItemReqArgs}}$("input[name='orderReq']").val(ec.lang.json.stringify(m));ec.order.invalidProduct.box.close();var a=$("input[name='state']").val();var m=$("input[name='orderReq']").val();var n=$("input[name='orderType']").val();if(n==16){var b="/order/priorityConfirm";ec.cart.allConfirm(a,m,n,b)}else{if(n==18){var b="/order/confirmDeposit";ec.cart.allConfirm(a,m,n,b)}else{if(n==25){var q=$("input[name='UIDesignID']").val();var i=$("input[name='sbs']").val();var o=$("input[name='css']").val();var e=$("input[name='qtys']").val();var d=$("input[name='ess']").val();var h=$("input[name='ass']").val();ec.cart.coverOrderConfirm(q,i,o,e,d,h)}else{if(n==26){var l="";l+='<input name="orderReqJson" type="text" value=\''+m+"'>";l+='<input name="routingTag" type="text" value="26">';l+='<input name="productId" type="text" value="'+ec.order.productId+'">';l+='<input name="skuId" type="text" value="'+ec.order.skuId+'">';l+='<input name="state" type="text" value="0">';var p=$('<form action="/order/nowConfirmcart" method="post"></form>');p.append(l);$("body").append(p);p.submit()}else{if(n==29){var b="/order/o2oConfirm";ec.cart.allConfirm(a,m,n,b)}else{if(n==14){var c=$("input[name='imeiCode']").val();l+='<input name="orderReqJson" type="text" value=\''+m+"'>";l+='<input name="productId" type="text" value="'+ec.order.productId+'">';l+='<input name="skuId" type="text" value="'+ec.order.skuId+'">';l+='<input name="imeiCode" type="text" value="'+c+'">';var p=$('<form action="/order/tcsConfirm" method="post"></form>');p.append(l);$("body").append(p);p.submit()}else{ec.cart.confirm(a,m,n)}}}}}}};ec.order.goBack=function(){if($("#orderType").val()==14){window.location.href=domainMain+"/order/tcsProductIndex"}else{var a=$("input[name='state']").val();if(a==0){if($("#orderType").val()==26){window.location.href="/product/"+ec.order.productId+".html#"+ec.order.skuId}else{window.location.href=$("a.p-name").attr("ahref")}}else{window.location.href=domainMain+"/cart2"}}};ec.order.couponTabChange=function(b){if(b=="coupon_tab"){$("#coupon_tab").addClass("current");$("#coupon_code_tab").removeClass("current");$("#order-roll-coupon>:first").removeClass("hide");$("#order-roll-coupon>:eq(1)").removeClass("hide");$("#order-roll-code>:first").addClass("hide");$("#order-roll-code>:eq(1)").addClass("hide");if($("li[name^='effCouponInfo_']").hasClass("current")){$("#use_coupon_btn").removeClass("disabled")}else{$("#use_coupon_btn").addClass("disabled");$("li[index^='effCouponInfo_']").removeClass("current")}var a=null;if($("#coupon_tab").attr("class")=="current"){a=$("#order-roll-coupon li.order-roll-detail.current").attr("id")}}else{if(b=="coupon_code_tab"){$("#coupon_tab").removeClass("current");$("#coupon_code_tab").addClass("current");$("#order-roll-coupon>:first").addClass("hide");$("#order-roll-coupon>:eq(1)").addClass("hide");$("#order-roll-code>:first").removeClass("hide");$("#order-roll-code>:eq(1)").removeClass("hide")}}};ec.order.couponSelected=function(a){$("#use_coupon_btn").removeClass("disabled");$("#"+a).addClass("current").siblings().removeClass("current")};ec.order.ecboxOpen=function(a){new ec.box($("#order-confim-box-tpl").val().replace("msg",a),{boxclass:"ol_box_4",boxid:"show_msg_box",width:700,modal:true,showButton:false,onok:function(b){b.close()}}).open()};ec.order.addressNullTips=function(){var a=[];a.push('<div class="box-content" style="height: auto;">');a.push('    <div class="box-prompt01-error">');a.push('<div class="h">');a.push("     <i></i>");a.push("</div>");a.push('<div class="b">');a.push('   <p id="success-message">\u8bf7\u60a8\u9009\u62e9\u6536\u8d27\u5730\u5740~</p>');a.push(" </div>");a.push("</div>");a.push('<div class="box-button">');a.push(' <a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a>');a.push("</div>");a.push("</div>");new ec.box(a.join(" "),{boxid:"address_null_tips",boxclass:"ol_box_4",width:600,height:230,title:"",showButton:false,onopen:function(b){b.setPosition()},onclose:function(){$("html,body").animate({scrollTop:$("#order-address-list ul").offset().top-100},100);$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")}}).open()};ec.order.globalNullTips=function(b,c){var a=[];a.push('<div class="box-content" style="height: auto;">');a.push('    <div class="box-prompt01-error">');a.push('<div class="h">');a.push("     <i></i>");a.push("</div>");a.push('<div class="b">');a.push('   <p id="success-message">'+b+"</p>");a.push(" </div>");a.push("</div>");a.push('<div class="box-button">');a.push(' <a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a>');a.push("</div>");a.push("</div>");new ec.box(a.join(" "),{boxid:"global_null_tips",boxclass:"ol_box_4",width:600,height:230,title:"",showButton:false,onopen:function(d){d.setPosition()},onclose:function(){if(c){c()}}}).open()};function pushPostOrderMsg(){var b=[];var a=[];var k=[];var d=[];var f=[];var h=[];var g=[];var c=[];$.each($("#order-normal-form").find("input[name=couSkuIds]"),function(){b.push($(this).attr("value"))});$.each($("#order-normal-form").find("input[name=couSkuCode]"),function(){a.push($(this).attr("value"))});$.each($("#order-normal-form").find("input[name=couSkuNum]"),function(){k.push($(this).attr("value"))});$.each($("#order-normal-form").find("input[name=couBundlerIds]"),function(){d.push($(this).attr("value"))});$.each($("#order-normal-form").find("input[name=couBundlerSkuCode]"),function(){f.push($(this).attr("value"))});$.each($("#order-normal-form").find("input[name=couBundlerNum]"),function(){h.push($(this).attr("value"))});for(var e=0;e<a.length;e++){g.push(a[e]+","+k[e]);c.push(b[e]+","+k[e])}for(var e=0;e<d.length;e++){g.push(f[e]+","+h[e]);c.push(d[e]+","+h[e])}var j={UID:ec.util.cookie.get("uid"),TID:getPtid(),TIME:getTime(),CONTENT:{SKUCode:g,bindId:c,click:"1"}};ec.code.addAnalytics({hicloud:true});_paq.push(["trackLink","300040101","link",j])}ec.order.giftMessage=function(){if($("#giftMessageTip").val().length<=100){$("#giftNumTips").text($("#giftMessageTip").val().length)}else{$("#giftNumTips").text(100);$("#giftMessageTip").val($("#giftMessageTip").val().substring(0,100))}};
